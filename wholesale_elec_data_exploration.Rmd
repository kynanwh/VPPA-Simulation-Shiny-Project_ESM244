---
title: "Wholesale Elec Data Exploration"
author: "Kynan Witters Hicks"
date: "January 20, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library, message = FALSE}

library(tidyverse)
library(janitor)
library(lubridate)
library(dplyr)
library(tsibble)
library(anytime)
library(nycflights13)
library(zoo)

```


###Wholesale Electricity Data Exploration

####CAISO

#####5-minute intervale data for three hubs: 
TH_NP15
TH_SP15
TH_ZP26

```{r get and format data, message=FALSE}

caiso <- read_csv("caiso.csv")

#convert "Data" data from character to date/time

caiso$date <- as.POSIXct(caiso$date,
                         format="%m/%d/%Y %H:%M")

```

```{r filter date by hub}

caiso_sp15 <- caiso %>% 
  filter(hub == "TH_SP15")

caiso_np15 <- caiso %>%
  filter(hub == "TH_NP15")

caiso_zp26 <- caiso %>% 
  filter(hub == "TH_ZP26")
```

```{r fill caiso data gaps, message=FALSE}

#sp15 hub

hub1 <- rep("TH_SP15", each=8760)

caiso_sp15_nodup <- caiso_sp15[!duplicated(caiso_sp15$date,
                                 by = c("date","hub")),]

caiso_sp15_clean <- caiso_sp15_nodup %>%
  as_tsibble(key = id(hub), index = date) %>% 
  fill_gaps(price = median(price)) %>% 
  index_by(datetime = floor_date(date, "hour")) %>% 
  summarise(price = mean(price))

caiso_sp15_clean2 <- data.frame(caiso_sp15_clean, hub1) %>% 
  rename(hub = hub1)
  
#np15 hub

hub2 <- rep("TH_NP15", each=8760)

caiso_np15_nodup <- caiso_np15[!duplicated(caiso_np15$date,
                                 by = c("date","hub")),]

caiso_np15_clean <- caiso_np15_nodup %>%
  as_tsibble(key = id(hub), index = date) %>% 
  fill_gaps(price = median(price)) %>% 
  index_by(datetime = floor_date(date, "hour")) %>% 
  summarise(price = mean(price))

caiso_np15_clean2 <- data.frame(caiso_np15_clean, hub2) %>% 
  rename(hub = hub2)

#zp26 hub

hub3 <- rep("TH_ZP26", each=8760)

caiso_zp26_nodup <- caiso_zp26[!duplicated(caiso_zp26$date,
                                 by = c("date","hub")),]

caiso_zp26_clean <- caiso_zp26_nodup %>%
  as_tsibble(key = id(hub), index = date) %>% 
  fill_gaps(price = median(price)) %>% 
  index_by(datetime = floor_date(date, "hour")) %>% 
  summarise(price = mean(price))

caiso_zp26_clean2 <- data.frame(caiso_zp26_clean, hub3) %>% 
  rename(hub = hub3)

#caiso_whole

caiso_nm <- rep("caiso", each = 26280)

caiso_bind <- rbind(caiso_np15_clean2, caiso_sp15_clean2, caiso_zp26_clean2)
caiso_clean <- data.frame(caiso_bind, caiso_nm) %>% 
  rename(iso = caiso_nm)

```

```{r export caiso hourly data}

write.csv(caiso_clean, "caiso_hourly.csv")

```


###Energy Model

```{r energy_model}

wind_tx <- read.csv("Texas_wind example.csv")

wind_tx$Timestamp <- mdy_hm(wind_tx$Timestamp)

wind_tx_2 <- wind_tx %>% 
  clean_names() %>% 
  select(timestamp, power_w, energy_m_wh)
  

ercot_energy <- full_join(wind_tx, ercot_dt, by = "timestamp") #Not working

```

